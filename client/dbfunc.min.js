!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).db=t()}(this,function(){"use strict";function e(e){var t=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):!!window.XMLHttpRequest&&new XMLHttpRequest;function n(t){e.success&&e.success(t)}function o(t){if(e.fail){var n=t;r&&n instanceof ArrayBuffer&&(o=t,n=window.TextDecoder?new window.TextDecoder("utf-8").decode(o):String.fromCharCode.apply(null,new Uint8Array(o))),e.fail(n)}var o}e.dataType=e.dataType||"json",t.onreadystatechange=function(){4===t.readyState&&("file:"==window.location.protocol&&0==t.status||t.status>=200&&t.status<300?r?n(t.response):t.responseText&&n("json"!==e.dataType?t.responseText:JSON.parse(t.responseText)):o(t.response),e.complete&&e.complete(t.response))},t.ontimeout=o,t.onerror=o,t.onabort=o;var r="arraybuffer"===t.responseType.toLowerCase();(e.type=e.type||"GET",e.type.toUpperCase(),t.open(e.type,e.url),t.timeout=e.timeout||0,t.responseType=e.responseType||"",e.headers&&"object"==typeof e.headers)?(e.headers["Content-type"]||(e.headers["Content-type"]="application/json;charset=utf-8"),Object.keys(e.headers).forEach(function(n){t.setRequestHeader(n,e.headers[n])})):"post"===e.type.toLowerCase()&&(t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.setRequestHeader("Content-type","application/json;charset=utf-8"));try{var s=e.data;e.data&&"object"==typeof e.data&&(s=JSON.stringify(e.data)),t.send(s)}catch(e){o(e)}return t}class t{constructor(){this.callbacks=[],this.alldone=null}delay(e){var t=new this.constructor;return setTimeout(function(){t.resolve()},e),t}then(e){return this.callbacks.push(e),this}resolve(e){var t=this,n=null,o=!1;setTimeout(()=>{if(t.callbacks.length){for(var r=0;r<t.callbacks.length;r++){var s=t.callbacks[r](n||e);if(s instanceof t.constructor){for(o=!0,r++;r<t.callbacks.length;r++)s.then(t.callbacks[r]);t.alldone&&(s.alldone=t.alldone),n=null}else n=s}o||t.alldone&&(t.alldone(n||e),t.alldone=null)}else t.alldone&&t.alldone(n||e)},0)}}return t.empty=function(e){var n=new t;return setTimeout(function(){n.resolve(e)},0),n},t.delay=function(e){var n=new t;return setTimeout(function(){n.resolve()},e),n},t.all=function(e){var prom=new t,n=0,o=[];function r(t){n++,o.push(t),n===e.length&&prom.resolve(o)}return e.forEach(e=>{e.alldone=r}),prom},{url:"https://node.ooomap.com/commondb",query:function(){var prom=new t,n={},o=Array.from(arguments);if(1===o.length&&"function"==typeof o[0])n.function=o[0].toString();else if(1===o.length&&"object"==typeof o[0]){if(!(n=o[0]).function)return t.empty();n.function=n.function.toString(),n.context=n.context instanceof Array?n.context:n.context?[n.context]:null}else if(2===o.length&&"string"==typeof o[0]&&"function"==typeof o[1])n.dbname=o[0],n.function=o[1].toString();else if(2===o.length&&"object"==typeof o[0]&&"function"==typeof o[1])n.context=o[0]instanceof Array?o[0]:[o[0]],n.function=o[1].toString();else{if(3!==o.length||"string"!=typeof o[0]||"object"!=typeof o[1]||"function"!=typeof o[1])return t.empty();n.dbname=o[0],n.context=o[1]instanceof Array?o[1]:[o[1]],n.function=o[2].toString()}return e({url:this.url,type:"post",data:n,success:e=>{prom.resolve(e)}}),prom}}});
